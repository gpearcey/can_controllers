<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>can_controllers: main/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">can_controllers
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains FreeRTOS tasks and pthread for sending and receiving messages between WASM app and CAN controller.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;freertos/FreeRTOS.h&quot;</code><br />
<code>#include &quot;freertos/task.h&quot;</code><br />
<code>#include &quot;<a class="el" href="NMEA__msg_8h_source.html">NMEA_msg.h</a>&quot;</code><br />
<code>#include &quot;esp_log.h&quot;</code><br />
<code>#include &lt;N2kMsg.h&gt;</code><br />
<code>#include &lt;NMEA2000_esp32-c6.h&gt;</code><br />
<code>#include &lt;NMEA2000.h&gt;</code><br />
<code>#include &lt;N2kMessages.h&gt;</code><br />
<code>#include &quot;driver/gpio.h&quot;</code><br />
<code>#include &quot;bi-inc/attr_container.h&quot;</code><br />
<code>#include &quot;wasm_export.h&quot;</code><br />
<code>#include &quot;bh_read_file.h&quot;</code><br />
<code>#include &quot;bh_getopt.h&quot;</code><br />
<code>#include &quot;bh_platform.h&quot;</code><br />
<code>#include &lt;queue&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;iomanip&gt;</code><br />
<code>#include &quot;nmea_attack.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp__incl.png" border="0" usemap="#amain_2main_8cpp" alt=""/></div>
<map name="amain_2main_8cpp" id="amain_2main_8cpp">
<area shape="rect" title="Contains FreeRTOS tasks and pthread for sending and receiving messages between WASM app and CAN contr..." alt="" coords="1233,5,1351,32"/>
<area shape="rect" title=" " alt="" coords="5,80,72,107"/>
<area shape="rect" title=" " alt="" coords="97,80,247,107"/>
<area shape="rect" title=" " alt="" coords="272,80,389,107"/>
<area shape="rect" href="NMEA__msg_8h.html" title="Represents a NMEA 2000 messages." alt="" coords="414,80,522,107"/>
<area shape="rect" title=" " alt="" coords="546,80,630,107"/>
<area shape="rect" title=" " alt="" coords="654,80,741,107"/>
<area shape="rect" title=" " alt="" coords="765,80,936,107"/>
<area shape="rect" title=" " alt="" coords="961,80,1066,107"/>
<area shape="rect" title=" " alt="" coords="1091,80,1216,107"/>
<area shape="rect" title=" " alt="" coords="1240,80,1344,107"/>
<area shape="rect" title=" " alt="" coords="1369,80,1533,107"/>
<area shape="rect" title=" " alt="" coords="1557,80,1680,107"/>
<area shape="rect" title=" " alt="" coords="1705,80,1818,107"/>
<area shape="rect" title=" " alt="" coords="1843,80,1941,107"/>
<area shape="rect" title=" " alt="" coords="1966,80,2079,107"/>
<area shape="rect" title=" " alt="" coords="2103,80,2166,107"/>
<area shape="rect" title=" " alt="" coords="2191,80,2249,107"/>
<area shape="rect" title=" " alt="" coords="2273,80,2348,107"/>
<area shape="rect" href="nmea__attack_8h_source.html" title=" " alt="" coords="2373,80,2491,107"/>
<area shape="rect" title=" " alt="" coords="437,155,499,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad16f1d8569e5ca70557cb0a89a1c59aa"><td class="memItemLeft" align="right" valign="top"><a id="ad16f1d8569e5ca70557cb0a89a1c59aa"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NATIVE_STACK_SIZE</b>&#160;&#160;&#160;(32*1024)</td></tr>
<tr class="separator:ad16f1d8569e5ca70557cb0a89a1c59aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a341e850f51af9acaba5184252e547464"><td class="memItemLeft" align="right" valign="top"><a id="a341e850f51af9acaba5184252e547464"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NATIVE_HEAP_SIZE</b>&#160;&#160;&#160;(32*1024)</td></tr>
<tr class="separator:a341e850f51af9acaba5184252e547464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5a3875f11b5c3d568eea8a9f7ac0db9"><td class="memItemLeft" align="right" valign="top"><a id="af5a3875f11b5c3d568eea8a9f7ac0db9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PTHREAD_STACK_SIZE</b>&#160;&#160;&#160;4096</td></tr>
<tr class="separator:af5a3875f11b5c3d568eea8a9f7ac0db9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae94f7f9b8282c3399a420a2fc7e90e6b"><td class="memItemLeft" align="right" valign="top"><a id="ae94f7f9b8282c3399a420a2fc7e90e6b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_DATA_LENGTH_BTYES</b>&#160;&#160;&#160;223</td></tr>
<tr class="separator:ae94f7f9b8282c3399a420a2fc7e90e6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b20d41d6252e9871430c242cb1a56e7"><td class="memItemLeft" align="right" valign="top"><a id="a6b20d41d6252e9871430c242cb1a56e7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>BUFFER_SIZE</b>&#160;&#160;&#160;(10 + 223*2)</td></tr>
<tr class="separator:a6b20d41d6252e9871430c242cb1a56e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a69c2759945fc6b51ee00ca0d06d7ca9b"><td class="memItemLeft" align="right" valign="top">tNMEA2000_esp32c6&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a69c2759945fc6b51ee00ca0d06d7ca9b">NMEA2000</a> (GPIO_NUM_4, GPIO_NUM_5)</td></tr>
<tr class="memdesc:a69c2759945fc6b51ee00ca0d06d7ca9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a NMEA2000 Object.  <a href="main_8cpp.html#a69c2759945fc6b51ee00ca0d06d7ca9b">More...</a><br /></td></tr>
<tr class="separator:a69c2759945fc6b51ee00ca0d06d7ca9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a955ad07241382211a8efdeaa2307443a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a955ad07241382211a8efdeaa2307443a">HandleNMEA2000Msg</a> (const tN2kMsg &amp;N2kMsg)</td></tr>
<tr class="memdesc:a955ad07241382211a8efdeaa2307443a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> object and adds it to the received messages queue.  <a href="main_8cpp.html#a955ad07241382211a8efdeaa2307443a">More...</a><br /></td></tr>
<tr class="separator:a955ad07241382211a8efdeaa2307443a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9bab62089a524c93c540021803c6009"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ac9bab62089a524c93c540021803c6009">nmea_to_string</a> (<a class="el" href="structNMEA__msg.html">NMEA_msg</a> &amp;msg)</td></tr>
<tr class="memdesc:ac9bab62089a524c93c540021803c6009"><td class="mdescLeft">&#160;</td><td class="mdescRight">converts a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> to a string  <a href="main_8cpp.html#ac9bab62089a524c93c540021803c6009">More...</a><br /></td></tr>
<tr class="separator:ac9bab62089a524c93c540021803c6009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc8e3680bd2b74044687c09abb1bcabf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#adc8e3680bd2b74044687c09abb1bcabf">vectorToCharArray</a> (const std::vector&lt; uint8_t &gt; &amp;data_vec, unsigned char(&amp;data_char_arr)[MAX_DATA_LENGTH_BTYES])</td></tr>
<tr class="memdesc:adc8e3680bd2b74044687c09abb1bcabf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fills a char array with values from a vector.  <a href="main_8cpp.html#adc8e3680bd2b74044687c09abb1bcabf">More...</a><br /></td></tr>
<tr class="separator:adc8e3680bd2b74044687c09abb1bcabf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54c259f26c52ff03f9ab1d90ba06dadf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a54c259f26c52ff03f9ab1d90ba06dadf">PrintStr</a> (wasm_exec_env_t exec_env, uint8_t *input, int32_t length)</td></tr>
<tr class="memdesc:a54c259f26c52ff03f9ab1d90ba06dadf"><td class="mdescLeft">&#160;</td><td class="mdescRight">prints a uint8_t array to terminal  <a href="main_8cpp.html#a54c259f26c52ff03f9ab1d90ba06dadf">More...</a><br /></td></tr>
<tr class="separator:a54c259f26c52ff03f9ab1d90ba06dadf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af074f4615d09245f6b9582f613e1e570"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#af074f4615d09245f6b9582f613e1e570">PrintInt32</a> (wasm_exec_env_t exec_env, int32_t number, int32_t hex)</td></tr>
<tr class="memdesc:af074f4615d09245f6b9582f613e1e570"><td class="mdescLeft">&#160;</td><td class="mdescRight">prints a integer to terminal  <a href="main_8cpp.html#af074f4615d09245f6b9582f613e1e570">More...</a><br /></td></tr>
<tr class="separator:af074f4615d09245f6b9582f613e1e570"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56a9e002e998217a1b1bf05ec84d1093"><td class="memItemLeft" align="right" valign="top"><a id="a56a9e002e998217a1b1bf05ec84d1093"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>AddAppDelay</b> (wasm_exec_env_t exec_env)</td></tr>
<tr class="separator:a56a9e002e998217a1b1bf05ec84d1093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5e3d97a79bfe28808d355b6f6aafae1"><td class="memItemLeft" align="right" valign="top"><a id="ab5e3d97a79bfe28808d355b6f6aafae1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>RemoveAppDelay</b> (wasm_exec_env_t exec_env)</td></tr>
<tr class="separator:ab5e3d97a79bfe28808d355b6f6aafae1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac689e9c910be33f383bb0d6421459c87"><td class="memItemLeft" align="right" valign="top"><a id="ac689e9c910be33f383bb0d6421459c87"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>GetMsg</b> (wasm_exec_env_t exec_env)</td></tr>
<tr class="separator:ac689e9c910be33f383bb0d6421459c87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f2304279f04a46457288b6d28fea042"><td class="memItemLeft" align="right" valign="top"><a id="a0f2304279f04a46457288b6d28fea042"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>SendMsg</b> (wasm_exec_env_t exec_env, int32_t controller_number, int32_t priority, int32_t PGN, int32_t source, uint8_t *data, int32_t data_length_bytes)</td></tr>
<tr class="separator:a0f2304279f04a46457288b6d28fea042"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac894d2ff5b41ee9ca73d7adb560d9416"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ac894d2ff5b41ee9ca73d7adb560d9416">SendN2kMsg</a> ()</td></tr>
<tr class="memdesc:ac894d2ff5b41ee9ca73d7adb560d9416"><td class="mdescLeft">&#160;</td><td class="mdescRight">takes mesages out of controller queue and sends message out on that controller  <a href="main_8cpp.html#ac894d2ff5b41ee9ca73d7adb560d9416">More...</a><br /></td></tr>
<tr class="separator:ac894d2ff5b41ee9ca73d7adb560d9416"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5504d2805dc0ba6317d0a5c83f22186e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a5504d2805dc0ba6317d0a5c83f22186e">N2K_receive_task</a> (void *pvParameters)</td></tr>
<tr class="memdesc:a5504d2805dc0ba6317d0a5c83f22186e"><td class="mdescLeft">&#160;</td><td class="mdescRight">FreeRTOS task for receiving messages from CAN controller.  <a href="main_8cpp.html#a5504d2805dc0ba6317d0a5c83f22186e">More...</a><br /></td></tr>
<tr class="separator:a5504d2805dc0ba6317d0a5c83f22186e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcaa9f46955f9eaa3af477ed9e5c9d53"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#abcaa9f46955f9eaa3af477ed9e5c9d53">N2K_task</a> (void *pvParameters)</td></tr>
<tr class="memdesc:abcaa9f46955f9eaa3af477ed9e5c9d53"><td class="mdescLeft">&#160;</td><td class="mdescRight">FreeRTOS task for processing and sending messages from CAN controller with NMEA2000 library.  <a href="main_8cpp.html#abcaa9f46955f9eaa3af477ed9e5c9d53">More...</a><br /></td></tr>
<tr class="separator:abcaa9f46955f9eaa3af477ed9e5c9d53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a1ac44c68d18bdde17fd90634a71222"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a3a1ac44c68d18bdde17fd90634a71222">iwasm_main</a> (void *arg)</td></tr>
<tr class="memdesc:a3a1ac44c68d18bdde17fd90634a71222"><td class="mdescLeft">&#160;</td><td class="mdescRight">WASM pthread to host wasm app.  <a href="main_8cpp.html#a3a1ac44c68d18bdde17fd90634a71222">More...</a><br /></td></tr>
<tr class="separator:a3a1ac44c68d18bdde17fd90634a71222"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a144c9a97815e4b794fd4352aedd33695"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a144c9a97815e4b794fd4352aedd33695">app_main</a> (void)</td></tr>
<tr class="memdesc:a144c9a97815e4b794fd4352aedd33695"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a FreeRTOS task for sending and receiving to and from CAN Controller and creates a pthread to run WASM app.  <a href="main_8cpp.html#a144c9a97815e4b794fd4352aedd33695">More...</a><br /></td></tr>
<tr class="separator:a144c9a97815e4b794fd4352aedd33695"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a48df899df614d98285854d93c794813b"><td class="memItemLeft" align="right" valign="top"><a id="a48df899df614d98285854d93c794813b"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a48df899df614d98285854d93c794813b">wasm_buffer</a> = NULL</td></tr>
<tr class="memdesc:a48df899df614d98285854d93c794813b"><td class="mdescLeft">&#160;</td><td class="mdescRight">buffer allocated for wasm app, used to hold received messages so app can access them <br /></td></tr>
<tr class="separator:a48df899df614d98285854d93c794813b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cce0fd0915d585bc2600a9520e6c9e9"><td class="memItemLeft" align="right" valign="top"><a id="a8cce0fd0915d585bc2600a9520e6c9e9"></a>
std::queue&lt; <a class="el" href="structNMEA__msg.html">NMEA_msg</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a8cce0fd0915d585bc2600a9520e6c9e9">received_msgs_q</a></td></tr>
<tr class="memdesc:a8cce0fd0915d585bc2600a9520e6c9e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue that stores all messages received on all controllers. <br /></td></tr>
<tr class="separator:a8cce0fd0915d585bc2600a9520e6c9e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab2ee5435f26d13831ec405df0a18ed6"><td class="memItemLeft" align="right" valign="top"><a id="aab2ee5435f26d13831ec405df0a18ed6"></a>
std::queue&lt; <a class="el" href="structNMEA__msg.html">NMEA_msg</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#aab2ee5435f26d13831ec405df0a18ed6">ctrl0_q</a></td></tr>
<tr class="memdesc:aab2ee5435f26d13831ec405df0a18ed6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue that stores messages to be sent out on controller 0. <br /></td></tr>
<tr class="separator:aab2ee5435f26d13831ec405df0a18ed6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8221896ec9a40b4527a5ecba283b4281"><td class="memItemLeft" align="right" valign="top"><a id="a8221896ec9a40b4527a5ecba283b4281"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>wasm_app_delay</b> = true</td></tr>
<tr class="separator:a8221896ec9a40b4527a5ecba283b4281"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4ab25cbe521c019efe65e33cbd24789"><td class="memItemLeft" align="right" valign="top"><a id="ae4ab25cbe521c019efe65e33cbd24789"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>read_msg_count</b> = 0</td></tr>
<tr class="separator:ae4ab25cbe521c019efe65e33cbd24789"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fd7e8735633201282654440183b0fee"><td class="memItemLeft" align="right" valign="top"><a id="a8fd7e8735633201282654440183b0fee"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>send_msg_count</b> = 0</td></tr>
<tr class="separator:a8fd7e8735633201282654440183b0fee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains FreeRTOS tasks and pthread for sending and receiving messages between WASM app and CAN controller. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>convert relavent ESP_LOGI to ESP_LOGD </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a144c9a97815e4b794fd4352aedd33695"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a144c9a97815e4b794fd4352aedd33695">&#9670;&nbsp;</a></span>app_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int app_main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a FreeRTOS task for sending and receiving to and from CAN Controller and creates a pthread to run WASM app. </p>
<p>In ESP-IDF, a pthread is just a wrapper on FreeRTOS </p>

</div>
</div>
<a id="a955ad07241382211a8efdeaa2307443a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a955ad07241382211a8efdeaa2307443a">&#9670;&nbsp;</a></span>HandleNMEA2000Msg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HandleNMEA2000Msg </td>
          <td>(</td>
          <td class="paramtype">const tN2kMsg &amp;&#160;</td>
          <td class="paramname"><em>N2kMsg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> object and adds it to the received messages queue. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>handle out of range data </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">N2kMsg</td><td>Reference to the N2KMs being handled </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a3a1ac44c68d18bdde17fd90634a71222"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a1ac44c68d18bdde17fd90634a71222">&#9670;&nbsp;</a></span>iwasm_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* iwasm_main </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>WASM pthread to host wasm app. </p>
<p>Sets up the wasm environment. Links native function to be exported. Calls wasm app function to link allocated wasm buffer. Runs main function in wasm app.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>unused - I don't know why this is required </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5504d2805dc0ba6317d0a5c83f22186e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5504d2805dc0ba6317d0a5c83f22186e">&#9670;&nbsp;</a></span>N2K_receive_task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void N2K_receive_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FreeRTOS task for receiving messages from CAN controller. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pvParameters</td><td>NMEA2000 Library is designed so that message receiving and sending is handled within the same task. In the NMEA2000_ESP32 library, this is made possible by letting the twai rx interrupt handle receiving CAN frames. In this library, the receiving is separated from the processing and sending of messages. This is done because I was unable to trigger recieving a CAN frame from the twai rx interrupt, so CAN_read_frame() must be called explicitly here. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abcaa9f46955f9eaa3af477ed9e5c9d53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcaa9f46955f9eaa3af477ed9e5c9d53">&#9670;&nbsp;</a></span>N2K_task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void N2K_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FreeRTOS task for processing and sending messages from CAN controller with NMEA2000 library. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>frame buffer should be 32 - see if this works </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pvParameters</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a69c2759945fc6b51ee00ca0d06d7ca9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69c2759945fc6b51ee00ca0d06d7ca9b">&#9670;&nbsp;</a></span>NMEA2000()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tNMEA2000_esp32c6 NMEA2000 </td>
          <td>(</td>
          <td class="paramtype">GPIO_NUM_4&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_NUM_5&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a NMEA2000 Object. </p>
<p>NMEA2000(TX_PIN, RX_PIN) </p>

</div>
</div>
<a id="ac9bab62089a524c93c540021803c6009"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9bab62089a524c93c540021803c6009">&#9670;&nbsp;</a></span>nmea_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string nmea_to_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNMEA__msg.html">NMEA_msg</a> &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>converts a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> to a string </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>make sure that if pgn is only 4 digits in hex it still takes 5 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>reference to a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::string representing the message </dd></dl>

</div>
</div>
<a id="af074f4615d09245f6b9582f613e1e570"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af074f4615d09245f6b9582f613e1e570">&#9670;&nbsp;</a></span>PrintInt32()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintInt32 </td>
          <td>(</td>
          <td class="paramtype">wasm_exec_env_t&#160;</td>
          <td class="paramname"><em>exec_env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>hex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prints a integer to terminal </p>
<p>Native function to be exported to WASM app. Used for debugging purposes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exec_env</td><td></td></tr>
    <tr><td class="paramname">number</td><td>integer to print </td></tr>
    <tr><td class="paramname">hex</td><td>prints the number in hex format if hex is 1, else prints it in decimal format </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a54c259f26c52ff03f9ab1d90ba06dadf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54c259f26c52ff03f9ab1d90ba06dadf">&#9670;&nbsp;</a></span>PrintStr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintStr </td>
          <td>(</td>
          <td class="paramtype">wasm_exec_env_t&#160;</td>
          <td class="paramname"><em>exec_env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prints a uint8_t array to terminal </p>
<p>Native function to be exported to WASM app. Used for debugging purposes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exec_env</td><td></td></tr>
    <tr><td class="paramname">input</td><td>pointer to array </td></tr>
    <tr><td class="paramname">length</td><td>length of the array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac894d2ff5b41ee9ca73d7adb560d9416"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac894d2ff5b41ee9ca73d7adb560d9416">&#9670;&nbsp;</a></span>SendN2kMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SendN2kMsg </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>takes mesages out of controller queue and sends message out on that controller </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd><p class="startdd">update time to take time from message </p>
<p class="enddd">update for multiple controllers</p>
</dd></dl>

</div>
</div>
<a id="adc8e3680bd2b74044687c09abb1bcabf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc8e3680bd2b74044687c09abb1bcabf">&#9670;&nbsp;</a></span>vectorToCharArray()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vectorToCharArray </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; uint8_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>data_vec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char(&amp;)&#160;</td>
          <td class="paramname"><em>data_char_arr</em>[MAX_DATA_LENGTH_BTYES]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fills a char array with values from a vector. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>add in error checking if data &gt; 223 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data_vec</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">data_char_arr</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
