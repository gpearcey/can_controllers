<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>can_controllers: main/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">can_controllers
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains FreeRTOS tasks and a pthread for sending and receiving messages between WASM app and CAN controllers.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;inttypes.h&gt;</code><br />
<code>#include &quot;freertos/FreeRTOS.h&quot;</code><br />
<code>#include &quot;freertos/task.h&quot;</code><br />
<code>#include &quot;<a class="el" href="NMEA__msg_8h_source.html">NMEA_msg.h</a>&quot;</code><br />
<code>#include &quot;esp_log.h&quot;</code><br />
<code>#include &lt;N2kMsg.h&gt;</code><br />
<code>#include &lt;NMEA2000_esp32-c6.h&gt;</code><br />
<code>#include &lt;NMEA2000.h&gt;</code><br />
<code>#include &lt;N2kMessages.h&gt;</code><br />
<code>#include &quot;esp_err.h&quot;</code><br />
<code>#include &quot;esp_pthread.h&quot;</code><br />
<code>#include &quot;driver/gpio.h&quot;</code><br />
<code>#include &quot;bi-inc/attr_container.h&quot;</code><br />
<code>#include &quot;wasm_export.h&quot;</code><br />
<code>#include &quot;bh_read_file.h&quot;</code><br />
<code>#include &quot;bh_getopt.h&quot;</code><br />
<code>#include &quot;bh_platform.h&quot;</code><br />
<code>#include &lt;queue&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;iomanip&gt;</code><br />
<code>#include &lt;chrono&gt;</code><br />
<code>#include &quot;nmea_attack.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp__incl.png" border="0" usemap="#amain_2main_8cpp" alt=""/></div>
<map name="amain_2main_8cpp" id="amain_2main_8cpp">
<area shape="rect" title="Contains FreeRTOS tasks and a pthread for sending and receiving messages between WASM app and CAN con..." alt="" coords="1489,5,1607,32"/>
<area shape="rect" title=" " alt="" coords="5,80,72,107"/>
<area shape="rect" title=" " alt="" coords="97,80,167,107"/>
<area shape="rect" title=" " alt="" coords="191,80,278,107"/>
<area shape="rect" title=" " alt="" coords="302,80,453,107"/>
<area shape="rect" title=" " alt="" coords="477,80,595,107"/>
<area shape="rect" href="NMEA__msg_8h.html" title="Represents a NMEA 2000 messages." alt="" coords="619,80,727,107"/>
<area shape="rect" title=" " alt="" coords="751,80,835,107"/>
<area shape="rect" title=" " alt="" coords="859,80,946,107"/>
<area shape="rect" title=" " alt="" coords="971,80,1141,107"/>
<area shape="rect" title=" " alt="" coords="1166,80,1271,107"/>
<area shape="rect" title=" " alt="" coords="1296,80,1421,107"/>
<area shape="rect" title=" " alt="" coords="1446,80,1527,107"/>
<area shape="rect" title=" " alt="" coords="1552,80,1667,107"/>
<area shape="rect" title=" " alt="" coords="1691,80,1795,107"/>
<area shape="rect" title=" " alt="" coords="1819,80,1983,107"/>
<area shape="rect" title=" " alt="" coords="2008,80,2131,107"/>
<area shape="rect" title=" " alt="" coords="2155,80,2269,107"/>
<area shape="rect" title=" " alt="" coords="2293,80,2392,107"/>
<area shape="rect" title=" " alt="" coords="2417,80,2530,107"/>
<area shape="rect" title=" " alt="" coords="2554,80,2617,107"/>
<area shape="rect" title=" " alt="" coords="2641,80,2700,107"/>
<area shape="rect" title=" " alt="" coords="2724,80,2799,107"/>
<area shape="rect" title=" " alt="" coords="2823,80,2889,107"/>
<area shape="rect" href="nmea__attack_8h_source.html" title=" " alt="" coords="2914,80,3033,107"/>
<area shape="rect" title=" " alt="" coords="642,155,705,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad16f1d8569e5ca70557cb0a89a1c59aa"><td class="memItemLeft" align="right" valign="top"><a id="ad16f1d8569e5ca70557cb0a89a1c59aa"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NATIVE_STACK_SIZE</b>&#160;&#160;&#160;(32*1024)</td></tr>
<tr class="separator:ad16f1d8569e5ca70557cb0a89a1c59aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a341e850f51af9acaba5184252e547464"><td class="memItemLeft" align="right" valign="top"><a id="a341e850f51af9acaba5184252e547464"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NATIVE_HEAP_SIZE</b>&#160;&#160;&#160;(32*1024)</td></tr>
<tr class="separator:a341e850f51af9acaba5184252e547464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5a3875f11b5c3d568eea8a9f7ac0db9"><td class="memItemLeft" align="right" valign="top"><a id="af5a3875f11b5c3d568eea8a9f7ac0db9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PTHREAD_STACK_SIZE</b>&#160;&#160;&#160;4096</td></tr>
<tr class="separator:af5a3875f11b5c3d568eea8a9f7ac0db9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae94f7f9b8282c3399a420a2fc7e90e6b"><td class="memItemLeft" align="right" valign="top"><a id="ae94f7f9b8282c3399a420a2fc7e90e6b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_DATA_LENGTH_BTYES</b>&#160;&#160;&#160;223</td></tr>
<tr class="separator:ae94f7f9b8282c3399a420a2fc7e90e6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b20d41d6252e9871430c242cb1a56e7"><td class="memItemLeft" align="right" valign="top"><a id="a6b20d41d6252e9871430c242cb1a56e7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>BUFFER_SIZE</b>&#160;&#160;&#160;(10 + 223*2)</td></tr>
<tr class="separator:a6b20d41d6252e9871430c242cb1a56e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22033beafc73a18758e9d1a022d4a6ed"><td class="memItemLeft" align="right" valign="top"><a id="a22033beafc73a18758e9d1a022d4a6ed"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MY_ESP_LOG_LEVEL</b>&#160;&#160;&#160;ESP_LOG_INFO</td></tr>
<tr class="separator:a22033beafc73a18758e9d1a022d4a6ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7a94e088643d957a2d02d9265ab6010"><td class="memItemLeft" align="right" valign="top"><a id="af7a94e088643d957a2d02d9265ab6010"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>STATS_TASK_PRIO</b>&#160;&#160;&#160;tskIDLE_PRIORITY</td></tr>
<tr class="separator:af7a94e088643d957a2d02d9265ab6010"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a180caf769e3cb391a833e441cb2c6fd5"><td class="memItemLeft" align="right" valign="top"><a id="a180caf769e3cb391a833e441cb2c6fd5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>STATS_TICKS</b>&#160;&#160;&#160;pdMS_TO_TICKS(1000)</td></tr>
<tr class="separator:a180caf769e3cb391a833e441cb2c6fd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c43cc4e702739ba614800838ffbb09c"><td class="memItemLeft" align="right" valign="top"><a id="a7c43cc4e702739ba614800838ffbb09c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ARRAY_SIZE_OFFSET</b>&#160;&#160;&#160;5</td></tr>
<tr class="separator:a7c43cc4e702739ba614800838ffbb09c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91cd690eeb190bd4abd4ec6d5d39bf59"><td class="memItemLeft" align="right" valign="top"><a id="a91cd690eeb190bd4abd4ec6d5d39bf59"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TX_QUEUE_SIZE</b>&#160;&#160;&#160;100</td></tr>
<tr class="separator:a91cd690eeb190bd4abd4ec6d5d39bf59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0616225f8714515d1139d62323d2fb60"><td class="memItemLeft" align="right" valign="top"><a id="a0616225f8714515d1139d62323d2fb60"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>RX_QUEUE_SIZE</b>&#160;&#160;&#160;100</td></tr>
<tr class="separator:a0616225f8714515d1139d62323d2fb60"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a69c2759945fc6b51ee00ca0d06d7ca9b"><td class="memItemLeft" align="right" valign="top">tNMEA2000_esp32c6&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a69c2759945fc6b51ee00ca0d06d7ca9b">NMEA2000</a> (GPIO_NUM_4, GPIO_NUM_5)</td></tr>
<tr class="memdesc:a69c2759945fc6b51ee00ca0d06d7ca9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a NMEA2000 Object.  <a href="main_8cpp.html#a69c2759945fc6b51ee00ca0d06d7ca9b">More...</a><br /></td></tr>
<tr class="separator:a69c2759945fc6b51ee00ca0d06d7ca9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a955ad07241382211a8efdeaa2307443a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a955ad07241382211a8efdeaa2307443a">HandleNMEA2000Msg</a> (const tN2kMsg &amp;N2kMsg)</td></tr>
<tr class="memdesc:a955ad07241382211a8efdeaa2307443a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> object and adds it to.data the received messages queue.  <a href="main_8cpp.html#a955ad07241382211a8efdeaa2307443a">More...</a><br /></td></tr>
<tr class="separator:a955ad07241382211a8efdeaa2307443a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9bab62089a524c93c540021803c6009"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ac9bab62089a524c93c540021803c6009">nmea_to_string</a> (<a class="el" href="structNMEA__msg.html">NMEA_msg</a> &amp;msg)</td></tr>
<tr class="memdesc:ac9bab62089a524c93c540021803c6009"><td class="mdescLeft">&#160;</td><td class="mdescRight">converts a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> to a string  <a href="main_8cpp.html#ac9bab62089a524c93c540021803c6009">More...</a><br /></td></tr>
<tr class="separator:ac9bab62089a524c93c540021803c6009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab74339dc719044b370c6c64a2cb2a4a6"><td class="memItemLeft" align="right" valign="top"><a id="ab74339dc719044b370c6c64a2cb2a4a6"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>uintArrToCharrArray</b> (uint8_t(&amp;data_uint8_arr)[MAX_DATA_LENGTH_BTYES], unsigned char(&amp;data_char_arr)[MAX_DATA_LENGTH_BTYES])</td></tr>
<tr class="separator:ab74339dc719044b370c6c64a2cb2a4a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54c259f26c52ff03f9ab1d90ba06dadf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a54c259f26c52ff03f9ab1d90ba06dadf">PrintStr</a> (wasm_exec_env_t exec_env, uint8_t *input, int32_t length)</td></tr>
<tr class="memdesc:a54c259f26c52ff03f9ab1d90ba06dadf"><td class="mdescLeft">&#160;</td><td class="mdescRight">prints a uint8_t array to terminal  <a href="main_8cpp.html#a54c259f26c52ff03f9ab1d90ba06dadf">More...</a><br /></td></tr>
<tr class="separator:a54c259f26c52ff03f9ab1d90ba06dadf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af074f4615d09245f6b9582f613e1e570"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#af074f4615d09245f6b9582f613e1e570">PrintInt32</a> (wasm_exec_env_t exec_env, int32_t number, int32_t hex)</td></tr>
<tr class="memdesc:af074f4615d09245f6b9582f613e1e570"><td class="mdescLeft">&#160;</td><td class="mdescRight">prints a integer to terminal  <a href="main_8cpp.html#af074f4615d09245f6b9582f613e1e570">More...</a><br /></td></tr>
<tr class="separator:af074f4615d09245f6b9582f613e1e570"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f2304279f04a46457288b6d28fea042"><td class="memItemLeft" align="right" valign="top"><a id="a0f2304279f04a46457288b6d28fea042"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>SendMsg</b> (wasm_exec_env_t exec_env, int32_t controller_number, int32_t priority, int32_t PGN, int32_t source, uint8_t *data, int32_t data_length_bytes)</td></tr>
<tr class="separator:a0f2304279f04a46457288b6d28fea042"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a106a265fd6a9f0387e494ba25c7acf60"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a106a265fd6a9f0387e494ba25c7acf60">uint8ArrayToCharrArray</a> (uint8_t(&amp;data_uint8_arr)[MAX_DATA_LENGTH_BTYES], unsigned char(&amp;data_char_arr)[MAX_DATA_LENGTH_BTYES])</td></tr>
<tr class="memdesc:a106a265fd6a9f0387e494ba25c7acf60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fills a char array with values from a uint8_t array.  <a href="main_8cpp.html#a106a265fd6a9f0387e494ba25c7acf60">More...</a><br /></td></tr>
<tr class="separator:a106a265fd6a9f0387e494ba25c7acf60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e126984e064bcc2a55c7455c3e3f6c3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a4e126984e064bcc2a55c7455c3e3f6c3">SendN2kMsg</a> (<a class="el" href="structNMEA__msg.html">NMEA_msg</a> msg)</td></tr>
<tr class="memdesc:a4e126984e064bcc2a55c7455c3e3f6c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a message.  <a href="main_8cpp.html#a4e126984e064bcc2a55c7455c3e3f6c3">More...</a><br /></td></tr>
<tr class="separator:a4e126984e064bcc2a55c7455c3e3f6c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe866e139af388e977898e984eef5408"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#afe866e139af388e977898e984eef5408">GetStatus</a> (const char *TAG)</td></tr>
<tr class="memdesc:afe866e139af388e977898e984eef5408"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves twai status and alerts.  <a href="main_8cpp.html#afe866e139af388e977898e984eef5408">More...</a><br /></td></tr>
<tr class="separator:afe866e139af388e977898e984eef5408"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5504d2805dc0ba6317d0a5c83f22186e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a5504d2805dc0ba6317d0a5c83f22186e">N2K_receive_task</a> (void *pvParameters)</td></tr>
<tr class="memdesc:a5504d2805dc0ba6317d0a5c83f22186e"><td class="mdescLeft">&#160;</td><td class="mdescRight">FreeRTOS task for receiving messages from CAN controller.  <a href="main_8cpp.html#a5504d2805dc0ba6317d0a5c83f22186e">More...</a><br /></td></tr>
<tr class="separator:a5504d2805dc0ba6317d0a5c83f22186e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71c34574289ce06034467cc2b49826fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a71c34574289ce06034467cc2b49826fa">N2K_send_task</a> (void *pvParameters)</td></tr>
<tr class="memdesc:a71c34574289ce06034467cc2b49826fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">FreeRTOS task for processing and sending messages from CAN controller with NMEA2000 library.  <a href="main_8cpp.html#a71c34574289ce06034467cc2b49826fa">More...</a><br /></td></tr>
<tr class="separator:a71c34574289ce06034467cc2b49826fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a1ac44c68d18bdde17fd90634a71222"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a3a1ac44c68d18bdde17fd90634a71222">iwasm_main</a> (void *arg)</td></tr>
<tr class="memdesc:a3a1ac44c68d18bdde17fd90634a71222"><td class="mdescLeft">&#160;</td><td class="mdescRight">WASM pthread to host wasm app.  <a href="main_8cpp.html#a3a1ac44c68d18bdde17fd90634a71222">More...</a><br /></td></tr>
<tr class="separator:a3a1ac44c68d18bdde17fd90634a71222"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a144c9a97815e4b794fd4352aedd33695"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a144c9a97815e4b794fd4352aedd33695">app_main</a> (void)</td></tr>
<tr class="memdesc:a144c9a97815e4b794fd4352aedd33695"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a FreeRTOS task for sending and receiving to and from CAN Controller and creates a pthread to run WASM app.  <a href="main_8cpp.html#a144c9a97815e4b794fd4352aedd33695">More...</a><br /></td></tr>
<tr class="separator:a144c9a97815e4b794fd4352aedd33695"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a88033e9988be1a1712cc1a5cad30a386"><td class="memItemLeft" align="right" valign="top"><a id="a88033e9988be1a1712cc1a5cad30a386"></a>
QueueHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a88033e9988be1a1712cc1a5cad30a386">controller0_tx_queue</a></td></tr>
<tr class="memdesc:a88033e9988be1a1712cc1a5cad30a386"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue that stores messages to be sent out on controller 0. <br /></td></tr>
<tr class="separator:a88033e9988be1a1712cc1a5cad30a386"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11b6808d4d3da250b22c4e713bfdb52d"><td class="memItemLeft" align="right" valign="top"><a id="a11b6808d4d3da250b22c4e713bfdb52d"></a>
QueueHandle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a11b6808d4d3da250b22c4e713bfdb52d">rx_queue</a></td></tr>
<tr class="memdesc:a11b6808d4d3da250b22c4e713bfdb52d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue that stores all messages received on all controllers. <br /></td></tr>
<tr class="separator:a11b6808d4d3da250b22c4e713bfdb52d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48df899df614d98285854d93c794813b"><td class="memItemLeft" align="right" valign="top"><a id="a48df899df614d98285854d93c794813b"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a48df899df614d98285854d93c794813b">wasm_buffer</a> = NULL</td></tr>
<tr class="memdesc:a48df899df614d98285854d93c794813b"><td class="mdescLeft">&#160;</td><td class="mdescRight">buffer allocated for wasm app, used to hold received messages so app can access them <br /></td></tr>
<tr class="separator:a48df899df614d98285854d93c794813b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4ab25cbe521c019efe65e33cbd24789"><td class="memItemLeft" align="right" valign="top"><a id="ae4ab25cbe521c019efe65e33cbd24789"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ae4ab25cbe521c019efe65e33cbd24789">read_msg_count</a> = 0</td></tr>
<tr class="memdesc:ae4ab25cbe521c019efe65e33cbd24789"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to track messages read. <br /></td></tr>
<tr class="separator:ae4ab25cbe521c019efe65e33cbd24789"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fd7e8735633201282654440183b0fee"><td class="memItemLeft" align="right" valign="top"><a id="a8fd7e8735633201282654440183b0fee"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a8fd7e8735633201282654440183b0fee">send_msg_count</a> = 0</td></tr>
<tr class="memdesc:a8fd7e8735633201282654440183b0fee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to track messages sent. <br /></td></tr>
<tr class="separator:a8fd7e8735633201282654440183b0fee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb8f55ef0d019e0d245fb1985dbe2a2a"><td class="memItemLeft" align="right" valign="top"><a id="aeb8f55ef0d019e0d245fb1985dbe2a2a"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#aeb8f55ef0d019e0d245fb1985dbe2a2a">alerts_to_enable</a> = TWAI_ALERT_RX_DATA | TWAI_ALERT_TX_FAILED | TWAI_ALERT_RX_QUEUE_FULL</td></tr>
<tr class="memdesc:aeb8f55ef0d019e0d245fb1985dbe2a2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets which alerts to enable for TWAI controller. <br /></td></tr>
<tr class="separator:aeb8f55ef0d019e0d245fb1985dbe2a2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c937c1adf8ddbc8393c5c835456b0a4"><td class="memItemLeft" align="right" valign="top"><a id="a3c937c1adf8ddbc8393c5c835456b0a4"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>rx_task_count</b> = 0</td></tr>
<tr class="separator:a3c937c1adf8ddbc8393c5c835456b0a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09d5aae9476513386bce59e21f4747bd"><td class="memItemLeft" align="right" valign="top"><a id="a09d5aae9476513386bce59e21f4747bd"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>tx_task_count</b> = 0</td></tr>
<tr class="separator:a09d5aae9476513386bce59e21f4747bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ddaf2882653dbb9f9c8a2299486585f"><td class="memItemLeft" align="right" valign="top"><a id="a8ddaf2882653dbb9f9c8a2299486585f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>wasm_pthread_count</b> = 0</td></tr>
<tr class="separator:a8ddaf2882653dbb9f9c8a2299486585f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30fb82f80237ef76f06cc22f503ccaa4"><td class="memItemLeft" align="right" valign="top"><a id="a30fb82f80237ef76f06cc22f503ccaa4"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>stats_task_count</b> = 0</td></tr>
<tr class="separator:a30fb82f80237ef76f06cc22f503ccaa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0b28aef7faa7753f9293fd57b8629bc"><td class="memItemLeft" align="right" valign="top"><a id="ab0b28aef7faa7753f9293fd57b8629bc"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><b>wasm_main_duration</b></td></tr>
<tr class="separator:ab0b28aef7faa7753f9293fd57b8629bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains FreeRTOS tasks and a pthread for sending and receiving messages between WASM app and CAN controllers. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>convert unessesary ESP_LOGI messages to ESP_LOGD </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a144c9a97815e4b794fd4352aedd33695"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a144c9a97815e4b794fd4352aedd33695">&#9670;&nbsp;</a></span>app_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int app_main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a FreeRTOS task for sending and receiving to and from CAN Controller and creates a pthread to run WASM app. </p>
<p>In ESP-IDF, a pthread is just a wrapper on FreeRTOS </p>

</div>
</div>
<a id="afe866e139af388e977898e984eef5408"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe866e139af388e977898e984eef5408">&#9670;&nbsp;</a></span>GetStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetStatus </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>TAG</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves twai status and alerts. </p>
<p>Used to display information regarding queue's filling up, and how many messages have been sent/received.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">TAG</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a955ad07241382211a8efdeaa2307443a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a955ad07241382211a8efdeaa2307443a">&#9670;&nbsp;</a></span>HandleNMEA2000Msg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HandleNMEA2000Msg </td>
          <td>(</td>
          <td class="paramtype">const tN2kMsg &amp;&#160;</td>
          <td class="paramname"><em>N2kMsg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> object and adds it to.data the received messages queue. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>handle out of range data </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">N2kMsg</td><td>Reference to the N2KMs being handled </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a3a1ac44c68d18bdde17fd90634a71222"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a1ac44c68d18bdde17fd90634a71222">&#9670;&nbsp;</a></span>iwasm_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* iwasm_main </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>WASM pthread to host wasm app. </p>
<p>Sets up the wasm environment. Links native function to be exported. Calls wasm app function to link allocated wasm buffer. Runs main function in wasm app.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>unused - I don't know why this is required </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5504d2805dc0ba6317d0a5c83f22186e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5504d2805dc0ba6317d0a5c83f22186e">&#9670;&nbsp;</a></span>N2K_receive_task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void N2K_receive_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FreeRTOS task for receiving messages from CAN controller. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pvParameters</td><td>NMEA2000 Library is designed so that message receiving and sending is handled within the same task. In the NMEA2000_ESP32 library, this is made possible by letting the twai rx interrupt handle receiving CAN frames. In this library, the receiving is separated from the processing and sending of messages. This is done because I was unable to trigger recieving a CAN frame from the twai rx interrupt, so CAN_read_frame() must be called explicitly here. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a71c34574289ce06034467cc2b49826fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71c34574289ce06034467cc2b49826fa">&#9670;&nbsp;</a></span>N2K_send_task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void N2K_send_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FreeRTOS task for processing and sending messages from CAN controller with NMEA2000 library. </p>
<p>Initializes NMEA2000 Object, then sends messages in loop.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>frame buffer should be 32 - see if this works </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pvParameters</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a69c2759945fc6b51ee00ca0d06d7ca9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69c2759945fc6b51ee00ca0d06d7ca9b">&#9670;&nbsp;</a></span>NMEA2000()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tNMEA2000_esp32c6 NMEA2000 </td>
          <td>(</td>
          <td class="paramtype">GPIO_NUM_4&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_NUM_5&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a NMEA2000 Object. </p>
<p>NMEA2000(TX_PIN, RX_PIN) </p>

</div>
</div>
<a id="ac9bab62089a524c93c540021803c6009"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9bab62089a524c93c540021803c6009">&#9670;&nbsp;</a></span>nmea_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string nmea_to_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNMEA__msg.html">NMEA_msg</a> &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>converts a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> to a string </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>make sure that if pgn is only 4 digits in hex it still takes 5 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>reference to a <a class="el" href="structNMEA__msg.html">NMEA_msg</a> object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::string representing the message </dd></dl>

</div>
</div>
<a id="af074f4615d09245f6b9582f613e1e570"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af074f4615d09245f6b9582f613e1e570">&#9670;&nbsp;</a></span>PrintInt32()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintInt32 </td>
          <td>(</td>
          <td class="paramtype">wasm_exec_env_t&#160;</td>
          <td class="paramname"><em>exec_env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>hex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prints a integer to terminal </p>
<p>Native function to be exported to WASM app. Used for debugging purposes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exec_env</td><td></td></tr>
    <tr><td class="paramname">number</td><td>integer to print </td></tr>
    <tr><td class="paramname">hex</td><td>prints the number in hex format if hex is 1, else prints it in decimal format </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a54c259f26c52ff03f9ab1d90ba06dadf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54c259f26c52ff03f9ab1d90ba06dadf">&#9670;&nbsp;</a></span>PrintStr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintStr </td>
          <td>(</td>
          <td class="paramtype">wasm_exec_env_t&#160;</td>
          <td class="paramname"><em>exec_env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prints a uint8_t array to terminal </p>
<p>Native function to be exported to WASM app. Used for debugging purposes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exec_env</td><td></td></tr>
    <tr><td class="paramname">input</td><td>pointer to array </td></tr>
    <tr><td class="paramname">length</td><td>length of the array </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4e126984e064bcc2a55c7455c3e3f6c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e126984e064bcc2a55c7455c3e3f6c3">&#9670;&nbsp;</a></span>SendN2kMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SendN2kMsg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNMEA__msg.html">NMEA_msg</a>&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a message. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd><p class="startdd">update time to take time from message </p>
<p class="enddd">update for multiple controllers</p>
</dd></dl>

</div>
</div>
<a id="a106a265fd6a9f0387e494ba25c7acf60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a106a265fd6a9f0387e494ba25c7acf60">&#9670;&nbsp;</a></span>uint8ArrayToCharrArray()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void uint8ArrayToCharrArray </td>
          <td>(</td>
          <td class="paramtype">uint8_t(&amp;)&#160;</td>
          <td class="paramname"><em>data_uint8_arr</em>[MAX_DATA_LENGTH_BTYES], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char(&amp;)&#160;</td>
          <td class="paramname"><em>data_char_arr</em>[MAX_DATA_LENGTH_BTYES]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fills a char array with values from a uint8_t array. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data_uint8_arr</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">data_char_arr</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
